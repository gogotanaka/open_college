<div class="home">
  <div class="inside clearfix">
    <div class="left_box">
      <ul>
        <li>
          <p class="class_name"><%= @class_room_for_year.name %></p>
          <p class="teacher_name"><%= link_to @class_room_for_year.teacher.name, teacher_path(@class_room_for_year.teacher.id) %></p>
        </li>
        <li>
          <p class="topic">全体</p>
          <ul class="clearfix">
            <li>
              20%<br>A
            </li>
            <li>
              30%<br>B
            </li>
            <li>
              40%<br>C
            </li>
            <li>
              10%<br>D
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="right_box">
      <% @class_room_for_year.class_rooms.order("year DESC").each_with_index do |class_room, i| %>
        <script type="text/javascript">
          $(function () {
            var chart;
            $(document).ready(function() {
              var colors = Highcharts.getOptions().colors, 
              categories = ['A', 'B', 'C', 'D', 'その他'], 
              name = 'Browser brands',
              data = 
              [
                {
                  y: <%= class_room.class_grades.where("grade = ?", "Ａ").count %>,
                  color: colors[0]
                },
                {
                  y: <%= class_room.class_grades.where("grade = ?", "Ｂ").count %>,
                  color: colors[1]
                },
                {
                  y: <%= class_room.class_grades.where("grade = ?", "Ｃ").count %>,
                  color: colors[2]
                },
                {
                  y: <%= class_room.class_grades.where("grade = ?", "Ｄ").count %>,
                  color: colors[3]
                },
                {
                  y: 0,
                  color: colors[4]
                }
              ];
              function setChart(name, categories, data, color) {
                chart.xAxis[0].setCategories(categories, false);
                chart.series[0].remove(false);
                chart.addSeries({
                  name: name,
                  data: data,
                  color: color || 'white'
                }, false);
                chart.redraw();
              }
              chart = new Highcharts.Chart({
                chart: {
                  renderTo: 'graph_container' + <%= i %>,
                  type: 'column'
                },
                title: {
                  text: <%= class_room.year %> + '年度'
                },
                subtitle: {
                  text: '成績分布グラフ'
                },
                xAxis: {
                  categories: categories
                },
                yAxis: {
                  title: {
                    text: '評定ごとの人数'
                  }
                },
                legend: {
                  enabled: false
                },
                plotOptions: {
                  column: {
                    cursor: 'pointer',
                    dataLabels: {
                      enabled: true,
                      color: colors[0],
                      style: {
                        fontWeight: 'bold'
                      },
                      formatter: function() {
                        return this.y +'人';
                      }
                    }
                  }
                },
                tooltip: {
                  formatter: function() {
                    var point = this.point,
                    s = this.x +':<b>'+ this.y +'人</b><br/>';
                    return s;
                  }
                },
                series: [{
                  name: name,
                  data: data,
                  color: 'white'
                }],
                exporting: {
                  enabled: false
                }
              });
            });
          });
        </script>
        <div id="graph_container<%= i %>" style="width:100%; height:400px; margin: 0 0 40px 0;"> </div>
        
        
        
        
        <% class_room.class_grades.each do |class_grade| %>
          <%= class_grade.grade %>
        <% end %>
      <% end %>
      
    </div>
  </div>
</div>